<!-- Cookie library and HLS streaming library -->
<script src="https://cdn.jsdelivr.net/js-cookie/2.2.0/js.cookie.js"></script>
<script src="https://cdn.jsdelivr.net/hls.js/0.7.6/hls.js"></script>

<!-- Check if the user is authenticated -->
<script>
  if (Cookies.get('auth_token') == null) {
    window.alert('Unauthenticated');
    //window.replace('/');
  }
</script>

<!-- Video feeds -->
<video id="video" width="640" height="360" autoplay></video><br>

<!-- Facilitate video streaming -->
<script>
  if(Hls.isSupported()) {
    var video = document.getElementById('video');
    var frontdoor = document.getElementById('frontdoor');

    var config = {
      xhrSetup: (xhr, url) => {
        // Authenticate our requests
        xhr.setRequestHeader("Authorization", "Bearer " + Cookies.get('auth_token'));
      }
    };

    var hls = new Hls(config);
    hls.loadSource('http://localhost:3000/camera/1/livestream.m3u8');
    hls.attachMedia(video);

    // Received video event, start playback
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      video.play();
    });

    // Error handling
    hls.on(Hls.Events.ERROR, function (event, data) {
      console.log('error');
      console.log(event);
      console.log(data);
    });
 }
</script>
